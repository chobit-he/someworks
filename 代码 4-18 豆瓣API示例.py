# -*- coding: utf-8 -*-import urllib.request, json, xml.dom.minidom, redef open_url(urls):	req = urllib.request.Request(urls, data = None, headers = acc_headers)	html = urllib.request.urlopen(req)	return htmldef getreviews(bids, uids):	url = '%s/%s/reviews' % (p_url, uids)	html = open_url(url)	DOMTree = xml.dom.minidom.parseString(html.read().decode('utf-8'))	feed = DOMTree.getElementsByTagName( "feed" )[0]	rbook = feed.getElementsByTagName( "opensearch:totalResults" )[0].childNodes[0].nodeValue	m = 1	while int(rbook) > 50 * (m-1):		url = '%s/%s/reviews?max-results=50&start-index=%d' % (p_url, uids, 50 * (m-1) + 1)		m += 1		html = open_url(url)		DOMTree = xml.dom.minidom.parseString(html.read().decode('utf-8'))		feed = DOMTree.getElementsByTagName( "feed" )[0]		entry = feed.getElementsByTagName( "feed" )		for i in entry:			subject = i.getElementsByTagName( "db:subject" )[0]			lbid = subject.getElementsByTagName( "id" )[0].childNodes[0].nodeValue			if lbid.startswith('http://book.douban.com/review/'):				bid_re = re.search('book.douban.com/subject/(.+?)/', lbid)				bid = bid_re.group(1)				result_list.append([bids, uids, bid])				if deep_int <= deep_r: # 深度判定循环					mainprocess(bid) ##def mainprocess(bids):	global deep_int ##	deep_int += 1 ##	url = '%s/%s/reviews' % (base_url, bids)	html = open_url(url)	html = json.loads(html.read().decode('utf-8'))	reviews_num = html['total']	n = 1	while reviews_num > 100 * (n-1):		url = '%s/%s/reviews?count=100&start=%d' % (base_url, bids, 100 * (n-1))		html = open_url(url)		html = json.loads(html.read().decode('utf-8'))		for i in html['reviews']:			a = i['author']			getreviews(bids, a['uid'])		n += 1acc_headers = {'Authorization': 'Bearer a14afef0f66fcffce3e0fcd2e34f6ff4'}base_url = 'https://api.douban.com/v2/book'p_url = 'https://api.douban.com/people'deep_r = 3 # 设定深度deep_int = 0 ##result_list = []mainprocess('5686369')print(result_list)